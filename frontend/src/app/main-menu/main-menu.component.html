<div class="menu-container">
  <h1>Time-Off Manager</h1>
  <p>Welcome, {{ userService.getName() }}</p>
  <div *ngIf="showDashboard" class="back-button-container">
</div>
  <button *ngIf="!showDashboard" (click)="showDashboard = true">Go to {{ userService.getRole() }} dashboard</button>
</div>

<div *ngIf="showDashboard">
  <div *ngIf="userService.getRole() === 'USER'" class="dashboard-container">
    <div class="actions">
      <button (click)="goBackToMenu()">Înapoi la meniu</button>
      <button (click)="toggleShowRequests()">Vezi cererile mele</button>
      <button (click)="toggleShowForm()">Adaugă cerere</button>
    </div>

    <div *ngIf="showForm" class="section">
      <h2>Adaugă cerere</h2>
      <form (submit)="submitNewRequest()">
        <label>Tip concediu:</label>
        <select [(ngModel)]="newLeaveRequest.leaveTypeId" name="leaveTypeId" required>
          <option *ngFor="let type of predefinedLeaveTypes" [value]="type.id">
            {{ type.name }}
          </option>
        </select>

        <label>De la:</label>
        <input type="date" [(ngModel)]="newLeaveRequest.startDate" name="startDate" required />

        <label>Până la:</label>
        <input type="date" [(ngModel)]="newLeaveRequest.endDate" name="endDate" required />

        <label>Note:</label>
        <input type="text" [(ngModel)]="newLeaveRequest.notes" name="notes" />

        <button type="submit">Trimite</button>
      </form>
    </div>

    <div *ngIf="showRequests && leaveRequests.length > 0" class="section">
      <h2>Cererile tale</h2>
      <ul>
        <li *ngFor="let request of leaveRequests">
            <p><strong>Tip:</strong>
            {{
              request.leaveTypeId === 1 ? 'Vacation' :
              request.leaveTypeId === 2 ? 'Sick leave' :
              'Undefined'
            }}
          </p>
          <p><strong>Perioadă:</strong> {{ formatDate(request.startDate) }} ➔ {{ formatDate(request.endDate) }}</p>
          <p><strong>Status:</strong> {{ request.status }}</p>
          <p><strong>Note:</strong> {{ request.notes }}</p>
          <button (click)="selectRequestForEdit(request)">Editeaza</button>
          <hr />
        </li>
      </ul>
    </div>

    <div *ngIf="selectedRequest" class="section">
      <h2>Editeaza cererea</h2>
      <form (submit)="updateLeaveRequest()">
        <label>De la:</label>
        <input type="date" [ngModel]="formatForInput(selectedRequest.startDate)" (ngModelChange)="selectedRequest.startDate = $event" name="editStartDate" required />

        <label>Până la:</label>
        <input type="date" [ngModel]="formatForInput(selectedRequest.endDate)" (ngModelChange)="selectedRequest.endDate = $event" name="editEndDate" required />

        <label>Note:</label>
        <input type="text" [(ngModel)]="selectedRequest.notes" name="editNotes" />

        <button type="submit">Salveaza</button>
        <button type="button" (click)="deleteLeaveRequest(selectedRequest.id)" class="btn-delete">Sterge</button>
        <button type="button" (click)="cancelEdit()">Inchide</button>
      </form>
    </div>
  </div>

  <div *ngIf="userService.getRole() === 'MANAGER'" class="dashboard-container">
    <h2>Dashboard Manager</h2>
    <button (click)="goBackToMenu()">Înapoi la meniu</button>
    <button (click)="toggleShowRequests()">Vezi cererile</button>
    <div class="section" *ngIf="showRequests">
      <h3>Cererile urilizatorilor</h3>
      <ul>
        <li *ngFor="let request of allRequests">
          <p><strong>Utilizator:</strong> {{ request.userName }}</p>
          <p><strong>Tip:</strong>
            {{
              request.leaveTypeId === 1 ? 'Vacation' :
              request.leaveTypeId === 2 ? 'Sick leave' :
              'Undefined'
            }}
          </p>
          <p><strong>Perioadă:</strong> {{ formatDate(request.startDate) }} ➔ {{ formatDate(request.endDate) }}</p>
          <p><strong>Note:</strong> {{ request.notes }}</p>
          <p><strong>Status:</strong> {{ request.status }}</p>
          <button *ngIf="request.status === 'PENDING'" (click)="approveLeaveRequest(request.id)">Aproba</button>
          <button *ngIf="request.status === 'PENDING'" (click)="rejectLeaveRequest(request.id)">Respinge</button>
        </li>
      </ul>
      <div *ngIf="allRequests.length === 0">
        <p>Nu sunt cereri de concediu pentru aprobat.</p>
    </div>

  </div>

  <div *ngIf="userService.getRole() === 'ADMIN'" class="dashboard-container">
    <h2>Dashboard Admin</h2>
    <p>Admin</p>
  </div>
</div>
